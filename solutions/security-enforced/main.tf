module "base_ocp_vpc" {
  source                                = "../fully-configurable"
  ibmcloud_api_key                      = var.ibmcloud_api_key
  existing_resource_group_name          = var.existing_resource_group_name
  prefix                                = var.prefix
  provider_visibility                   = "private"
  cluster_resource_tags                 = var.cluster_resource_tags
  access_tags                           = var.access_tags
  cluster_name                          = var.cluster_name
  ocp_version                           = var.ocp_version
  ocp_entitlement                       = var.ocp_entitlement
  cluster_ready_when                    = var.cluster_ready_when
  enable_ocp_console                    = var.enable_ocp_console
  addons                                = var.addons
  manage_all_addons                     = var.manage_all_addons
  worker_pools_taints                   = var.worker_pools_taints
  ignore_worker_pool_size_changes       = var.ignore_worker_pool_size_changes
  allow_default_worker_pool_replacement = var.allow_default_worker_pool_replacement
  default_worker_pool_machine_type      = var.default_worker_pool_machine_type
  default_worker_pool_workers_per_zone  = var.default_worker_pool_workers_per_zone
  default_worker_pool_operating_system  = var.default_worker_pool_operating_system
  default_worker_pool_labels            = var.default_worker_pool_labels
  default_worker_pool_secondary_storage = var.default_worker_pool_secondary_storage
  enable_autoscaling_for_default_pool   = var.enable_autoscaling_for_default_pool
  default_pool_minimum_number_of_nodes  = var.default_pool_minimum_number_of_nodes
  default_pool_maximum_number_of_nodes  = var.default_pool_maximum_number_of_nodes
  additional_security_group_ids         = var.additional_security_group_ids
  additional_worker_pools               = var.additional_worker_pools
  existing_cos_instance_crn             = var.existing_cos_instance_crn
  existing_vpc_crn                      = var.existing_vpc_crn
  existing_subnet_ids                   = var.existing_subnet_ids
  use_private_endpoint                  = true
  disable_public_endpoint               = true
  cluster_config_endpoint_type          = "private"
  disable_outbound_traffic_protection   = false
  verify_worker_network_readiness       = var.verify_worker_network_readiness
  pod_subnet_cidr                       = var.pod_subnet_cidr
  service_subnet_cidr                   = var.service_subnet_cidr
  custom_security_group_ids             = var.custom_security_group_ids
  attach_ibm_managed_security_group     = var.attach_ibm_managed_security_group
  additional_lb_security_group_ids      = var.additional_lb_security_group_ids
  number_of_lbs                         = var.number_of_lbs
  additional_vpe_security_group_ids     = var.additional_vpe_security_group_ids
  kms_encryption_enabled_cluster        = true
  existing_kms_instance_crn             = var.existing_kms_instance_crn
  existing_cluster_kms_key_crn          = var.existing_cluster_kms_key_crn
  kms_endpoint_type                     = "private"
  cluster_key_ring_name                 = var.cluster_key_ring_name
  cluster_key_name                      = var.cluster_key_name
  ibmcloud_kms_api_key                  = var.ibmcloud_kms_api_key
  kms_encryption_enabled_boot_volume    = true
  existing_boot_volume_kms_key_crn      = var.existing_boot_volume_kms_key_crn
  boot_volume_key_ring_name             = var.boot_volume_key_ring_name
  boot_volume_key_name                  = var.boot_volume_key_name
  cbr_rules                             = var.cbr_rules
}
